version: '3.7'
services:

  db:
    image: mariadb
    container_name: db
    volumes:
        - harvester_db:/var/lib/mysql
    environment:
        MYSQL_ROOT_PASSWORD: 1234
        MYSQL_DATABASE: harvester


  adminer:
    image: adminer
    container_name: adminer
    ports:
        - 8080:8080
    depends_on:
        - db

  harvester:
    build:
        context: .
        target: gcc_debug
    image: harvester
    container_name: harvester
    ports:
        - 9002:9002
    tty: true
    volumes:
        - type: bind
          source: ./
          target: /project
        - type: bind
          source: ./data/apis
          target: /tmp/stored/apis
        - type: bind
          source: ./data/api_schema.json
          target: /tmp/stored/api_schema.json
        - harvester_bin:/project/bin/
    depends_on:
        - db

volumes:
    harvester_bin:
    harvester_db:
